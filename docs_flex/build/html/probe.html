
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Probing &#8212; Flex GUI  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tools" href="tools.html" />
    <link rel="prev" title="Python Module" href="python.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tools.html" title="Tools"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="python.html" title="Python Module"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Flex GUI  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Probing</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="probing">
<h1>Probing<a class="headerlink" href="#probing" title="Permalink to this heading">¶</a></h1>
<section id="probe-enable">
<h2>Probe Enable<a class="headerlink" href="#probe-enable" title="Permalink to this heading">¶</a></h2>
<p>Add a QPushButton named <cite>probing_enable_pb</cite> and if it is found it will be set as
a toggle button. The button will only be enabled when the machine is homed and
not running a program. The button is set to checkable in code so it can be
styled with :checked and :enabled pseudo-states among others.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <cite>probing_enable_pb</cite> requires at least one object that starts with
<cite>probe_</cite> to be enabled.</p>
</div>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">QPushButton</span><span class="p">#</span><span class="nn">probing_enable_pb</span><span class="p">:</span><span class="nd">enabled</span><span class="p">:</span><span class="nd">checked</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">        </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">red</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">QPushButton</span><span class="p">#</span><span class="nn">probing_enable_pb</span><span class="p">:</span><span class="nd">enabled</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">green</span><span class="p">;</span>
<span class="w">        </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">yellow</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A QPushButton with checkable set to true does not have an unchecked
pseudo-state</p>
</div>
<p>For more style sheet options see the <a class="reference internal" href="style.html"><span class="doc">StyleSheet</span></a> section</p>
<p>The text on the Probe Enable button can be set by adding two Dynamic Properties
named <cite>on_text</cite> and <cite>off_text</cite>. Both must be present or no change will take
place as there is no default text for the Probe Enable button.
See <a class="reference internal" href="property.html"><span class="doc">Dynamic Properties</span></a></p>
<img alt="_images/probe-00.png" class="align-center" src="_images/probe-00.png" />
<p>This is what the button would look like with the above settings.</p>
<img alt="_images/probe-01.png" class="align-center" src="_images/probe-01.png" />
</section>
<section id="function">
<h2>Function<a class="headerlink" href="#function" title="Permalink to this heading">¶</a></h2>
<p>When the <cite>probing_enable_pb</cite> is toggled <cite>OFF</cite>, any widget with an object name
that starts with <cite>probe_</cite> will be disabled.</p>
<p>When the <cite>probing_enable_pb</cite> is toggled <cite>ON</cite> the widgets that start with
<cite>probe_</cite> will be enabled. In addition, spindle controls will disabled, spindle
speed set to 0, run controls will be disabled, and MDI controls will be disabled.</p>
<p>QPushButtons with an objectName that start with <cite>probe_</cite> and configured as a
<a class="reference internal" href="mdi.html#mdibuttontag"><span class="std std-ref">MDI Button</span></a> (to launch the probing subroutines) will be enabled when
probing is enabled and disabled when probing is disabled.</p>
<p>You can create a HAL <a class="reference internal" href="hal.html#spinboxtag"><span class="std std-ref">Spinbox</span></a> to use in your probing subroutine. Set
the objectName to start with <cite>probe_</cite> and it will be enabled and disabled with
the probe buttons.</p>
<p>If you’re using a touch-screen, add a Dynamic Property named <cite>input</cite> and set
the value to <cite>touch</cite>.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h2>
<p>A minimal example is in the Flex Examples in the Features directory</p>
<img alt="_images/probe-02.png" class="align-center" src="_images/probe-02.png" />
<p>To run the example, close the E Stop, turn Power on, Home all, then toggle the
Enable button. When probing is enabled many other controls are disabled
including the spindle.</p>
<p>To test the probe routine press the Probe X Plus button and the X axis will
start to move in the positive direction. If you do nothing when the Search
Distance is reached you will get an error that the G38.2 move finished without
making contact, which is expected.</p>
<p>Press the Probe X Plus button again and after it starts to move, press the Probe
Trip button, the X axis will back off the Backoff Distance and start to move in
the positive direction again. Pressing the Probe Trip button again will end the
probe simulation. The debug information will show up in the Information window.</p>
</section>
<section id="subroutine">
<h2>Subroutine<a class="headerlink" href="#subroutine" title="Permalink to this heading">¶</a></h2>
<p>The probe subroutines use the values from the Probe Settings spin boxes. To use
these values, you need to make the spin box a HAL pin. See the <a class="reference internal" href="hal.html#spinboxtag"><span class="std std-ref">Spinbox</span></a>
example in the HAL section.</p>
<p>The subroutine is located in a directory called <cite>subroutines</cite> that is in the
configuration directory. The ini’s [RS274NGC] SUBROUTINE_PATH sets the path
that LinuxCNC looks for subroutines. Notice the leading ./ specifices that the
path to the current directory is where the subroutine directory is.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SUBROUTINE_PATH</span> <span class="o">=</span> <span class="o">./</span><span class="n">subroutines</span>
</pre></div>
</div>
<p>The example files used are the following; notice that the xplus.ngc is in
the ./subroutines directory</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── main.hal
├── parameters.var
├── parameters.var.bak
├── postgui.hal
├── probe.ini
├── probe.ui
├── README
├── sim_axis_probe.ini
├── subroutines
│   └── xplus.ngc
└── tool.tbl
</pre></div>
</div>
<p>In your subroutine you can use user parameters instead of using HAL pins.
See the <a class="reference internal" href="parameters.html"><span class="doc">Parameters</span></a> section.</p>
<p>The subroutine is a normal LinuxCNC subroutine. The magic is how you get the
values from HAL pins with <cite>#&lt;_hal[pin_name]&gt;</cite> where pin_name is the actual
pin name in HAL.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">filename</span> <span class="n">xplus</span><span class="o">.</span><span class="n">ngc</span><span class="p">)</span>
<span class="p">(</span><span class="n">HAL</span> <span class="n">pins</span> <span class="c1">#&lt;_hal[pin_name]&gt;)</span>
<span class="p">(</span><span class="n">G90</span> <span class="n">absolute</span> <span class="n">distance</span> <span class="n">mode</span> <span class="n">G91</span> <span class="n">incremental</span> <span class="n">distance</span> <span class="n">mode</span><span class="p">)</span>
<span class="n">o</span><span class="o">&lt;</span><span class="n">xplus</span><span class="o">&gt;</span> <span class="n">sub</span>
        <span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">xplus</span> <span class="n">subroutine</span><span class="p">)</span>
        <span class="n">G20</span>
        <span class="p">;</span> <span class="n">initial</span> <span class="n">search</span>
        <span class="n">G91</span> <span class="n">G38</span><span class="mf">.2</span> <span class="n">F</span><span class="c1">#&lt;_hal[flexhal.search-speed]&gt; X#&lt;_hal[flexhal.search-distance]&gt;</span>
        <span class="p">;</span><span class="mi">5061</span><span class="o">-</span><span class="mi">5069</span> <span class="o">-</span> <span class="n">Coordinates</span> <span class="n">of</span> <span class="n">a</span> <span class="n">G38</span> <span class="n">probe</span> <span class="n">result</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span> <span class="o">&amp;</span> <span class="n">W</span><span class="p">)</span>
        <span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="n">Probe</span> <span class="n">Contact</span> <span class="n">at</span> <span class="c1">#5061)</span>
        <span class="p">;</span> <span class="n">back</span> <span class="n">off</span> <span class="n">using</span> <span class="c1">#5061 to compensate for over travel on the probe</span>
        <span class="n">G90</span> <span class="n">G0</span> <span class="n">X</span><span class="p">[</span><span class="c1">#5061-#&lt;_hal[flexhal.backoff-distance]&gt;]</span>
        <span class="p">;</span> <span class="n">final</span> <span class="n">probe</span> <span class="n">at</span> <span class="n">latch</span> <span class="n">speed</span>
        <span class="n">G91</span> <span class="n">G38</span><span class="mf">.2</span> <span class="n">F</span><span class="c1">#&lt;_hal[flexhal.latch-speed]&gt; X[#&lt;_hal[flexhal.backoff-distance]&gt; + 0.02]</span>
        <span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="n">Probe</span> <span class="n">Contact</span> <span class="n">at</span> <span class="c1">#5061)</span>
<span class="n">o</span><span class="o">&lt;</span><span class="n">xplus</span><span class="o">&gt;</span> <span class="n">endsub</span>
<span class="n">M2</span>
</pre></div>
</div>
<p>Looking at the Halshow window which pops up when you press the Show HAL button,
you can see the flexhal pin names for each spin box and for the Probe Trip
button. Also notice that the Probe Trip button is connected to a signal which is
connected to motion.probe-input in the postgui.hal file</p>
<img alt="_images/probe-03.png" class="align-center" src="_images/probe-03.png" />
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Probing</a><ul>
<li><a class="reference internal" href="#probe-enable">Probe Enable</a></li>
<li><a class="reference internal" href="#function">Function</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#subroutine">Subroutine</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="python.html"
                          title="previous chapter">Python Module</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="tools.html"
                          title="next chapter">Tools</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/probe.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tools.html" title="Tools"
             >next</a> |</li>
        <li class="right" >
          <a href="python.html" title="Python Module"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Flex GUI  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Probing</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2024, John Thornton.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>